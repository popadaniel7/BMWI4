#include "Std_Types.h"
#include "FreeRTOS.h"
#include "cmsis_os.h"
#include "timers.h"
#include "wwdg.h"

#define RESET_CONTEXT_UNKNOWN 				0x01
#define RESET_CONTEXT_RESET_BUTTON_PRESSED 	0x02
#define HARD_FAULT_CONTEXT					0x03
#define FLASH_FAULT_CONTEXT					0x04

#define POWER_ON_RESET  	0x0010
#define BROWN_OUT_RESET 	0x0011
#define SOFTWARE_RESET 		0x0012
#define WATCHDOG_RESET		0x0013
#define LOW_POWER_RESET 	0x0014
#define BUTTON_RESET		0x0015
#define HARDWARE_RESET		0x0016
#define FLASH_FAULT_RESET 	0x0017
#define NMI_RESET			0x0018
#define MEMORY_FAULT_RESET  0x0019
#define USAGE_FAULT_RESET	0x0020
#define BUS_FAULT_RESET		0x0021

#define I2C_FAULT_ERROR			1
#define SPI_FAULT_ERROR			2
#define ADC_FAULT_ERROR			3
#define UART_FAULT_ERROR		4
#define WATCHDOG_FAULT_ERROR	5
#define TIMER_FAULT_ERROR		6

EXTERN unsigned long Os_Counter;
EXTERN WWDG_HandleTypeDef hwwdg;
EXTERN uint8 SystemManager_TriggerResetFlag;

EXTERN osTimerId_t Os_SecAlm_AlarmResetHandle;
EXTERN osTimerId_t Os_CenLoc_LockUnlockSequence_TimerHandle;

EXTERN osEventFlagsId_t SysEvent_NMIHandlerHandle;
EXTERN osEventFlagsId_t SysEvent_HardFaultHandle;
EXTERN osEventFlagsId_t SysEvent_MemManageHandle;
EXTERN osEventFlagsId_t SysEvent_BusFaultHandle;
EXTERN osEventFlagsId_t SysEvent_PVDHandle;
EXTERN osEventFlagsId_t SysEvent_UsageFaultHandle;
EXTERN osEventFlagsId_t SysEvent_FlashFaultHandle;
EXTERN osEventFlagsId_t SysEvent_I2CErrorHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_BORHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LowPowerResetHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_HardwareResetHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_SoftwareResetHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_PowerOnResetHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_WatchdogResetHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_I2CFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_SPIFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_ADCFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_USARTFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_WatchdogFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_FlashFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_TimerFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_BORHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_ButtonResetHandle;

EXTERN osEventFlagsId_t DemEvent_DTC_LowBeamShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LowBeamUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_HighBeamUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_HighBeamShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_DayTimeRunningLightUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_DayTimeRunningLightShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_FrontFogLightsUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_FrontFogLightShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_RearFogLightUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_RearFogLightShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_RearPositionLightUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_RearPositionLightShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_RightTurnSignalUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LeftTurnSignalUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_RightTurnSignalShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LeftTurnSignalShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_ReverseLightUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_ReverseLightShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_InteriorLightsUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_InteriorLightsShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_DoorLedUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_DoorLedShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LicensePlateLigthUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LicensePlateLigthShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_Mcp2515FaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_ExtEEPROMFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_VibrationSensorFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_LightSensorFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_HC05FaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_AlarmLedUnderVoltageHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_AlarmLedShortedHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_CentralLockBuzzerFaultHandle;
EXTERN osEventFlagsId_t DemEvent_DTC_AlarmBuzzerFaultHandle;

EXTERN void SystemClock_Config(void);
EXTERN void Error_Handler(void);
EXTERN void MX_NVIC_Init(void);

EXTERN StdReturnType SystemManager_Init();
EXTERN StdReturnType SystemManager_SetReset(uint8 resetType);
EXTERN StdReturnType SystemManager_ProcessResetErrorFault();
EXTERN StdReturnType SystemManager_TriggerDTC();
EXTERN StdReturnType SystemManager_StoreInNvM();
EXTERN void SystemManager_ReadFromNvM();
EXTERN void SystemManager_MainFunction();
EXTERN void SystemManager_PerformReset();

