#include "PDC.h"
#include "tim.h"
#include "FreeRTOS.h"
#include "main.h"

uint8 Pdc_FrontRxDelay;
uint8 Pdc_FrontEchoFirstTimeStampValue;
uint8 Pdc_FrontEchoSecondTimeStampValue;
uint8 Pdc_FrontDistanceValue;
uint8 Pdc_TimerValueForFrontBuzzer;
uint8 Pdc_RearRxDelay;
uint8 Pdc_RearEchoFirstTimeStampValue;
uint8 Pdc_RearEchoSecondTimeStampValue;
uint8 Pdc_RearDistanceValue;
uint8 Pdc_TimerValueForRearBuzzer;
uint8 Pdc_RearGenerateDelayFlag;
uint8 Pdc_FrontGenerateDelayFlag;
uint8 Pdc_FrontDelayStatus;
uint8 Pdc_RearDelayStatus;

StdReturnType PdcInit();
void PdcMainFunction();
void PdcToggleFrontTriggerPin(uint8 PinState);
void PdcToggleRearTriggerPin(uint8 PinState);
void PdcReadFrontEchoPin();
void PdcReadRearEchoPin();
void PdcFrontDistance();
void PdcRearDistance();
void PdcFrontGenerateDelay();
void PdcRearGenerateDelay();
void PdcFrontBuzzerControl();
void PdcRearBuzzerControl();
void PdcFrontStatus();
void PdcRearStatus();
void PdcFrontBuzzerTimer();
void PdcRearBuzzerTimer();

void PdcRearGenerateDelay()
{

	Pdc_RearGenerateDelayFlag = STD_LOW;
	osTimerStart(PdcRearDelayTimerHandle, PDC_DELAY_VALUE_TEN);

	if(Pdc_RearGenerateDelayFlag == STD_HIGH)
	{

		Pdc_RearDelayStatus = STD_HIGH;

	}
	else if(Pdc_RearGenerateDelayFlag == STD_LOW)
	{

		Pdc_RearDelayStatus = STD_LOW;

	}
	else
	{

		/* do nothing */

	}

}

void PdcFrontGenerateDelay()
{

	Pdc_FrontGenerateDelayFlag = STD_LOW;
	osTimerStart(PdcFrontDelayTimerHandle, PDC_DELAY_VALUE_TEN);

	if(Pdc_FrontGenerateDelayFlag == STD_HIGH)
	{

		Pdc_FrontDelayStatus = STD_HIGH;

	}
	else if(Pdc_FrontGenerateDelayFlag == STD_LOW)
	{

		Pdc_FrontDelayStatus = STD_LOW;

	}
	else
	{

		/* do nothing */

	}

}

void PdcFrontStatus()
{

	/* pdc impl */

}

void PdcRearStatus()
{

	/* pdc impl */

}

void PdcFrontBuzzerTimer()
{

	/* init timer for front buzzer */

}

void PdcRearBuzzerTimer()
{

	/* init timer for rear buzzer */

}

void PdcToggleFrontTriggerPin(uint8 PinState)
{

	HAL_GPIO_WritePin(PDC_FRONT_TRIGGER_PORT, PDC_FRONT_TRIGGER_PIN, PinState);

}

void PdcToggleRearTriggerPin(uint8 PinState)
{

	HAL_GPIO_WritePin(PDC_FRONT_TRIGGER_PORT, PDC_FRONT_TRIGGER_PIN, PinState);

}

void PdcReadFrontEchoPin()
{

	HAL_GPIO_ReadPin(PDC_FRONT_ECHO_PORT, PDC_FRONT_ECHO_PIN);

}

void PdcReadRearEchoPin()
{

	HAL_GPIO_ReadPin(PDC_REAR_ECHO_PORT, PDC_REAR_ECHO_PIN);

}

void PdcFrontDistance()
{

	Pdc_FrontDistanceValue = (Pdc_FrontEchoFirstTimeStampValue + Pdc_FrontEchoSecondTimeStampValue) * 0.034 / 2;

}


void PdcRearDistance()
{

	Pdc_RearDistanceValue = (Pdc_RearEchoFirstTimeStampValue + Pdc_RearEchoSecondTimeStampValue) * 0.034 / 2;

}

void PdcRearBuzzerControl()
{

	PdcRearBuzzerTimer();

	if(Pdc_RearDistanceValue <= PDC_SAFETY_DISTANCE_ONE)
	{

		if(Pdc_TimerValueForRearBuzzer < 5000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

		}
		else if(5000 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 10000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_LOW);

		}
		else
		{

			/* do nothing */

		}

	}
	else if(Pdc_RearDistanceValue <= PDC_SAFETY_DISTANCE_TWO)
	{

		if(Pdc_TimerValueForRearBuzzer < 2500)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

		}
		else if(2500 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 5000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_LOW);

		}
		else if(5000 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 7500)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

		}
		else if(7500 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 10000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_LOW);

		}
		else
		{

			/* do nothing */

		}

	}
	else if(Pdc_RearDistanceValue <= PDC_SAFETY_DISTANCE_THREE)
	{

		if(Pdc_TimerValueForRearBuzzer < 1250)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

		}
		else if(1250 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 2500)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_LOW);

		}
		else if(2500 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 5000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

		}
		else if(5000 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 7500)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_LOW);

		}
		else if(7500 < Pdc_TimerValueForRearBuzzer  && Pdc_TimerValueForRearBuzzer < 10000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

		}
		else if(Pdc_TimerValueForRearBuzzer == 10000)
		{

			HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_LOW);

		}
		else
		{

			/* do nothing */

		}

	}
	else if(Pdc_RearDistanceValue <= PDC_SAFETY_DISTANCE_FOUR)
	{

		HAL_GPIO_WritePin(PDC_REAR_BUZZER_PORT, PDC_REAR_BUZZER_PIN, STD_HIGH);

	}
	else
	{

		/* do nothing */

	}

}

void PdcFrontBuzzerControl()
{

	PdcFrontBuzzerTimer();

	if(Pdc_FrontDistanceValue <= PDC_SAFETY_DISTANCE_ONE)
	{

		if(Pdc_TimerValueForFrontBuzzer < 5000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

		}
		else if(5000 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 10000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_LOW);

		}
		else
		{

			/* do nothing */

		}

	}
	else if(Pdc_FrontDistanceValue <= PDC_SAFETY_DISTANCE_TWO)
	{

		if(Pdc_TimerValueForFrontBuzzer < 2500)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

		}
		else if(2500 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 5000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_LOW);

		}
		else if(5000 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 7500)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

		}
		else if(7500 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 10000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_LOW);

		}
		else
		{

			/* do nothing */

		}

	}
	else if(Pdc_FrontDistanceValue <= PDC_SAFETY_DISTANCE_THREE)
	{

		if(Pdc_TimerValueForFrontBuzzer < 1250)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

		}
		else if(1250 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 2500)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_LOW);

		}
		else if(2500 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 5000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

		}
		else if(5000 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 7500)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_LOW);

		}
		else if(7500 < Pdc_TimerValueForFrontBuzzer  && Pdc_TimerValueForFrontBuzzer < 10000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

		}
		else if(Pdc_TimerValueForFrontBuzzer == 10000)
		{

			HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_LOW);

		}
		else
		{

			/* do nothing */

		}

	}
	else if(Pdc_FrontDistanceValue <= PDC_SAFETY_DISTANCE_FOUR)
	{

		HAL_GPIO_WritePin(PDC_FRONT_BUZZER_PORT, PDC_FRONT_BUZZER_PIN, STD_HIGH);

	}
	else
	{

		/* do nothing */

	}

}

void PdcMainFunction()
{

	PdcFrontStatus();
	PdcRearStatus();

}

StdReturnType PdcInit()
{

	Pdc_FrontRxDelay 					= STD_LOW;
	Pdc_FrontEchoFirstTimeStampValue 	= STD_LOW;
	Pdc_FrontEchoSecondTimeStampValue 	= STD_LOW;
	Pdc_FrontDistanceValue 				= STD_LOW;
	Pdc_TimerValueForFrontBuzzer 		= STD_LOW;
	Pdc_RearRxDelay 					= STD_LOW;
	Pdc_RearEchoFirstTimeStampValue 	= STD_LOW;
	Pdc_RearEchoSecondTimeStampValue 	= STD_LOW;
	Pdc_RearDistanceValue 				= STD_LOW;
	Pdc_TimerValueForRearBuzzer 		= STD_LOW;
	Pdc_RearGenerateDelayFlag			= STD_LOW;
	Pdc_FrontGenerateDelayFlag 			= STD_LOW;
	Pdc_FrontDelayStatus 				= STD_LOW;

	return E_OK;

}
