#include "Dem.h"
#include "Dem_Types.h"
#include "SystemManager.h"
#include "SystemManager_Types.h"
#include "NvM.h"

Dem_DtcType Dem_DtcArray;
Dem_DtcType Dem_DtcArrayStoredInFlash;

StdReturnType Dem_Init();
StdReturnType Dem_DeInit();
void Dem_MainFunction();
void Dem_ProcessSystemFault();
void Dem_ProcessCircuitFault();
void Dem_SetDtc();
StdReturnType Dem_StoreInFlash();
StdReturnType Dem_ReadFromFlash();

StdReturnType Dem_StoreInFlash()
{

	for(uint8 index = 0; index <= 34; index++)
	{

		if(Dem_DtcArrayStoredInFlash.dtcValue[index] != Dem_DtcArray.dtcValue[index])
		{

			NvM_Write(SM_FAULT_START_ADDRESS, (uint8*)&SystemManager_Fault[index], 1);

		}

	}

	return E_OK;

}

StdReturnType Dem_ReadFromFlash()
{

	NvM_Read(SM_FAULT_START_ADDRESS, SystemManager_FaultStoredInFlash, SM_FAULT_BYTES);

	return E_OK;

}

StdReturnType Dem_Init()
{

	return E_OK;

}

StdReturnType Dem_DeInit()
{

	return E_OK;

}

void Dem_MainFunction()
{

}

void Dem_ProcessSystemFault()
{

	for(uint8 index = 0; index < 35; index++)
	{

		if(SystemManager_Fault.fault[index] == index + 1)
		{

			Dem_DtcArray.dtcValue[index] = SystemManager_Fault.fault[index];

		}
		else
		{

			/* do nothing */

		}

	}

}

void Dem_ProcessCircuitFault()
{

	uint8 receivedValue = 0; /* rte read */

	for(uint8 index = 35; index <= 72; index++)
	{

		if(receivedValue == index + 1)
		{

			Dem_DtcArray.dtcValue[index] = receivedValue;

		}
		else
		{

			/* do nothing */

		}

	}

}
